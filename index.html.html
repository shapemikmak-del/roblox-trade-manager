<!doctype html>
<html lang="he" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Roblox Trade Manager — דף ניהול מכירות</title>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- Google Font -->
<link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
:root{
  --bg: #0f1113;
  --card: #121418;
  --accent: #00ffcc;
  --accent-2: #2f7eff;
  --accent-3: #00c853;
  --danger: #ff3b30;
  --muted: #9aa3b2;
  --glass: rgba(255,255,255,0.03);
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;background:var(--bg);font-family:'Rubik',sans-serif;color:#e6eef7}
.header{
  display:flex;gap:16px;align-items:center;justify-content:space-between;padding:18px 22px;background:linear-gradient(90deg,#071021,#0d1220);
  border-bottom:1px solid rgba(255,255,255,0.03);
}
.brand{display:flex;align-items:center;gap:12px}
.logo{
  width:46px;height:46px;border-radius:10px;background:linear-gradient(135deg,#2f7eff,#00ffcc);
  display:flex;align-items:center;justify-content:center;font-weight:700;color:#041126;font-size:18px;
  box-shadow:0 6px 20px rgba(47,126,255,0.12), inset 0 -6px 12px rgba(0,0,0,0.25);
}
.title{font-size:18px;font-weight:600}
.header-actions{display:flex;gap:10px;align-items:center}

/* layout */
.main{
  padding:18px;
  display:grid;
  grid-template-columns: 360px 1fr;
  gap:18px;
}
@media(max-width:980px){
  .main{grid-template-columns:1fr; padding:12px}
}

/* left column controls */
.panel{background:var(--card);border-radius:12px;padding:16px;box-shadow:0 6px 24px rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.02)}
.panel h3{margin:0 0 12px 0;color:var(--accent);font-size:16px}
.input{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:var(--glass);color:inherit;margin-bottom:8px}
.row{display:flex;gap:8px}
.small{flex:1}
.btn{padding:10px;border-radius:8px;border:none;font-weight:600;cursor:pointer}
.btn.green{background:linear-gradient(90deg,var(--accent-3),#0ab46a);color:#01120b}
.btn.blue{background:linear-gradient(90deg,var(--accent-2),#3b6eff);color:white}
.btn.red{background:linear-gradient(90deg,#ff5b5b,#ff3b30);color:white}
.controls-footer{display:flex;flex-direction:column;gap:8px;margin-top:8px}

/* right column: dashboard */
.grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:18px;
}
@media(max-width:1200px){ .grid{grid-template-columns:1fr} }

.card{
  background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border-radius:12px;padding:14px;border:1px solid rgba(255,255,255,0.03);
  box-shadow:0 10px 30px rgba(2,6,23,0.6);
}
.card h4{margin:0 0 10px 0;color:#cbeef2}

/* summary strip */
.summary{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:10px;flex-wrap:wrap}
.summary .item{background:#071019;padding:10px;border-radius:10px;min-width:140px;text-align:center;border:1px solid rgba(255,255,255,0.03)}
.summary .item .num{font-weight:700;color:var(--accent);font-size:20px}
.summary .item .sub{font-size:12px;color:var(--muted)}

/* tables */
.table{width:100%;border-collapse:collapse;margin-top:10px;color:#dbeefc;font-size:14px}
.table th, .table td{padding:8px 10px;border-bottom:1px dashed rgba(255,255,255,0.02);text-align:center}
.table th{font-size:13px;color:var(--muted)}
.actions-btn{padding:6px 8px;border-radius:8px;border:none;cursor:pointer}

/* search/filter row */
.search-row{display:flex;gap:8px;align-items:center;margin-bottom:10px}
.search-row .input{flex:1}

/* footer controls */
.bottom-actions{display:flex;gap:8px;align-items:center;justify-content:flex-end;margin-top:12px;flex-wrap:wrap}

/* charts area full width */
.charts{grid-column:1 / -1;display:grid;gap:12px}
.canvas-wrap{padding:8px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));}

/* responsive tweaks */
@media(max-width:600px){
  .summary .item{min-width:100px}
  .brand .title{display:none}
}
</style>
</head>
<body>

<header class="header">
  <div class="brand">
    <div class="logo">RBX</div>
    <div>
      <div class="title">Roblox Trade Manager</div>
      <div style="font-size:12px;color:var(--muted)">ניהול קניות ומכירות — גרסה מקצועית</div>
    </div>
  </div>
</header>

<main class="main">
  <!-- LEFT: CONTROLS -->
  <section>
    <div class="panel card">
      <h3>הוסף עסקה חדשה</h3>
      <input id="inputItem" class="input" placeholder="שם פריט" />
      <div class="row">
        <input id="inputPrice" type="number" class="input small" placeholder="מחיר (₪)" />
        <input id="inputDate" type="date" class="input small" />
      </div>
      <div class="row">
        <button id="btnBuy" class="btn green">הוסף קנייה</button>
        <button id="btnSell" class="btn blue">הוסף מכירה</button>
      </div>
      <div class="controls-footer">
        <label style="font-size:13px;color:var(--muted)">כלי נתונים</label>
        <input id="importFile" type="file" accept=".json" />
        <div style="display:flex;gap:8px;margin-top:4px">
          <button id="btnExport" class="btn" style="background:#0b1220;color:var(--accent)">ייצא JSON</button>
          <button id="btnClear" class="btn red">נקה נתונים</button>
        </div>
      </div>
    </div>

    <div class="panel card" style="margin-top:14px">
      <h3>חיפוש ופילטר</h3>
      <div class="search-row">
        <input id="searchBox" class="input" placeholder="חפש לפי שם פריט..." />
      </div>
      <div class="row">
        <input id="filterFrom" type="date" class="input small" />
        <input id="filterTo" type="date" class="input small" />
      </div>
      <div style="margin-top:8px">
        <button id="btnFilter" class="btn" style="background:#1b2738;color:var(--accent)">החל סינון</button>
        <button id="btnResetFilter" class="btn" style="background:transparent;border:1px solid rgba(255,255,255,0.04);margin-left:8px">איפוס</button>
      </div>
    </div>
  </section>

  <!-- RIGHT: DASHBOARD -->
  <section>
    <div class="grid">
      <!-- SUMMARY -->
      <div class="card">
        <h4>סיכום מהיר</h4>
        <div class="summary">
          <div class="item"><div class="num" id="totalProfit">0 ₪</div><div class="sub">רווח כולל</div></div>
          <div class="item"><div class="num" id="totalSpent">0 ₪</div><div class="sub">סה"כ קניות</div></div>
          <div class="item"><div class="num" id="totalEarned">0 ₪</div><div class="sub">סה"כ מכירות</div></div>
          <div class="item"><div class="num" id="countBought">0</div><div class="sub">כמות קניות</div></div>
          <div class="item"><div class="num" id="countSold">0</div><div class="sub">כמות מכירות</div></div>
        </div>
      </div>

      <!-- TRANSACTIONS TABLE -->
      <div class="card">
        <h4>רשימת עסקאות</h4>
        <table class="table" id="txTable">
          <thead><tr><th>סוג</th><th>פריט</th><th>מחיר ₪</th><th>תאריך</th><th>פעולות</th></tr></thead>
          <tbody id="txBody"></tbody>
        </table>
        <div class="bottom-actions">
          <div style="flex:1;color:var(--muted);font-size:13px">תוצאות: <span id="txCount">0</span></div>
        </div>
      </div>

      <!-- CHARTS -->
      <div class="card charts">
        <h4>גרפים וניתוחים</h4>

        <div class="canvas-wrap card" style="padding:12px">
          <div style="font-weight:600;color:var(--muted);margin-bottom:8px">רווח יומי (מכירות − קניות)</div>
          <canvas id="profitChart" height="120"></canvas>
        </div>

        <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
          <div class="canvas-wrap card">
            <div style="font-weight:600;color:var(--muted);margin-bottom:8px">הוצאות יומיות (קניות)</div>
            <canvas id="expensesChart" height="120"></canvas>
          </div>
          <div class="canvas-wrap card">
            <div style="font-weight:600;color:var(--muted);margin-bottom:8px">מכירות יומיות</div>
            <canvas id="salesChart" height="120"></canvas>
          </div>
        </div>

       
      </div>
    </div>
  </section>
</main>

<script>
window.addEventListener('DOMContentLoaded', () => {
  // --- Utilities ---
  const uid = () => 't' + Math.random().toString(36).slice(2, 10);
  const pad = n => n.toString().padStart(2, '0');
  const todayISO = () => {
    const d = new Date();
    return `${d.getFullYear()}-${pad(d.getMonth() + 1)}-${pad(d.getDate())}`;
  };
  const fmt = v => (Number(v) || 0).toLocaleString('he-IL');

  // --- DOM Elements ---
  const inputItem = document.getElementById('inputItem');
  const inputPrice = document.getElementById('inputPrice');
  const inputDate = document.getElementById('inputDate');
  const btnBuy = document.getElementById('btnBuy');
  const btnSell = document.getElementById('btnSell');
  const btnExport = document.getElementById('btnExport');
  const btnClear = document.getElementById('btnClear');
  const importFile = document.getElementById('importFile');
  const searchBox = document.getElementById('searchBox');
  const filterFrom = document.getElementById('filterFrom');
  const filterTo = document.getElementById('filterTo');
  const btnFilter = document.getElementById('btnFilter');
  const btnResetFilter = document.getElementById('btnResetFilter');

  const txBody = document.getElementById('txBody');
  const txCount = document.getElementById('txCount');
  const totalProfit = document.getElementById('totalProfit');
  const totalSpent = document.getElementById('totalSpent');
  const totalEarned = document.getElementById('totalEarned');
  const countBought = document.getElementById('countBought');
  const countSold = document.getElementById('countSold');

  // --- State ---
  const STORAGE_KEY = 'roblox_trade_data_v1';
  let transactions = [];
  let filtered = null;

  // --- Charts ---
  let profitChart, expensesChart, salesChart, pieExpenses;

  // --- Local Storage ---
  function saveLocal() { localStorage.setItem(STORAGE_KEY, JSON.stringify(transactions)); }
  function loadLocal() {
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      transactions = raw ? JSON.parse(raw) : [];
    } catch (e) { transactions = []; }
  }

  // --- CRUD ---
  function addTransaction(type, item, price, date) {
  cleanAfterAction();
    transactions.push({ id: uid(), type, item: item.trim(), price: Number(price), date });
    saveLocal();
    refreshUI();
  }
function cleanAfterAction()
{
inputItem.value='';
inputPrice.value='';
inputDate.value='';
}
  function editTransaction(id, newData) {
    const idx = transactions.findIndex(x => x.id === id);
    if (idx >= 0) {
      transactions[idx] = { ...transactions[idx], ...newData };
      saveLocal();
      refreshUI();
    }
  }

  function deleteTransaction(id) {
    transactions = transactions.filter(x => x.id !== id);
    saveLocal();
    refreshUI();
  }

  // --- Filtering ---
  function getFilteredData() {
    const q = searchBox.value.trim().toLowerCase();
    const from = filterFrom.value;
    const to = filterTo.value;
    let data = transactions;
    if (q) data = data.filter(tx => tx.item.toLowerCase().includes(q));
    if (from) data = data.filter(tx => tx.date >= from);
    if (to) data = data.filter(tx => tx.date <= to);
    return data;
  }

  function applyFilters() {
    filtered = getFilteredData();
    renderTable(filtered);
    updateSummary(filtered);
    updateChartsFromData(filtered);
  }

  function resetFilters() {
    searchBox.value = '';
    filterFrom.value = '';
    filterTo.value = '';
    filtered = null;
    refreshUI();
  }

  // --- Rendering ---
  function renderTable(data) {
    txBody.innerHTML = '';
    data.forEach(tx => {
      const tr = document.createElement('tr');

      const tdType = document.createElement('td');
      tdType.innerHTML = tx.type === 'buy' ? '<strong style="color:#ff9b9b">קנייה</strong>' :
        '<strong style="color:#9be0ff">מכירה</strong>';
      tr.appendChild(tdType);

      const tdItem = document.createElement('td'); tdItem.textContent = tx.item; tr.appendChild(tdItem);
      const tdPrice = document.createElement('td'); tdPrice.textContent = fmt(tx.price); tr.appendChild(tdPrice);
      const tdDate = document.createElement('td'); tdDate.textContent = tx.date; tr.appendChild(tdDate);

      const tdActions = document.createElement('td');
      const btnE = document.createElement('button'); btnE.textContent = 'ערוך'; btnE.className = 'actions-btn';
      btnE.onclick = () => openEditModal(tx);
      tdActions.appendChild(btnE);

      const btnD = document.createElement('button'); btnD.textContent = 'מחק'; btnD.className = 'actions-btn';
      btnD.style.marginInlineStart = '6px';
      btnD.style.background = 'linear-gradient(90deg,#ff5757,#ff3b30)';
      btnD.style.color = 'white';
      btnD.onclick = () => { if (confirm('למחוק את העסקה?')) deleteTransaction(tx.id); };
      tdActions.appendChild(btnD);

      tr.appendChild(tdActions);
      txBody.appendChild(tr);
    });
    txCount.textContent = data.length;
  }

  // --- Summary ---
  function updateSummary(data) {
    const arr = data || transactions;
    const countB = arr.filter(tx => tx.type === 'buy').length;
    const countS = arr.filter(tx => tx.type === 'sell').length;
    const totalBought = arr.filter(tx => tx.type === 'buy').reduce((sum, tx) => sum + tx.price, 0);
    const totalSold = arr.filter(tx => tx.type === 'sell').reduce((sum, tx) => sum + tx.price, 0);
    const profit = totalSold - totalBought;

    countBought.textContent = countB;
    countSold.textContent = countS;
    totalSpent.textContent = fmt(totalBought) + ' ₪';
    totalEarned.textContent = fmt(totalSold) + ' ₪';
    totalProfit.textContent = fmt(profit) + ' ₪';
  }

  // --- Charts ---
  function groupByDate(arr) {
    const map = {};
    arr.forEach(tx => {
      if (!map[tx.date]) map[tx.date] = { spent: 0, earned: 0 };
      if (tx.type === 'buy') map[tx.date].spent += tx.price;
      else map[tx.date].earned += tx.price;
    });
    return map;
  }

  function updateChartsFromData(data) {
    const arr = data || transactions;
    const map = groupByDate(arr);
    const dates = Object.keys(map).sort((a, b) => new Date(a) - new Date(b));

    profitChart.data.labels = dates;
    profitChart.data.datasets[0].data = dates.map(d => map[d].earned - map[d].spent);
    profitChart.update();

    expensesChart.data.labels = dates;
    expensesChart.data.datasets[0].data = dates.map(d => map[d].spent);
    expensesChart.update();

    salesChart.data.labels = dates;
    salesChart.data.datasets[0].data = dates.map(d => map[d].earned);
    salesChart.update();

    const expenseByItem = {};
    arr.forEach(tx => { if (tx.type === 'buy') expenseByItem[tx.item] = (expenseByItem[tx.item] || 0) + tx.price; });
    const items = Object.keys(expenseByItem).sort((a, b) => expenseByItem[b] - expenseByItem[a]).slice(0, 12);
    pieExpenses.data.labels = items;
    pieExpenses.data.datasets[0].data = items.map(i => expenseByItem[i]);
    pieExpenses.update();
  }

  function initCharts() {
    profitChart = new Chart(document.getElementById('profitChart').getContext('2d'), {
      type: 'line',
      data: { labels: [], datasets: [{ label: 'רווח יומי (₪)', data: [], borderColor: '#00ffcc', backgroundColor: 'rgba(0,255,204,0.08)', tension: 0.2, fill: true, pointRadius: 4 }] },
      options: { plugins: { legend: { display: false } }, scales: { y: { ticks: { color: '#dbeefc' } }, x: { ticks: { color: '#9aa3b2' } } } }
    });

    expensesChart = new Chart(document.getElementById('expensesChart').getContext('2d'), {
      type: 'bar',
      data: { labels: [], datasets: [{ label: 'הוצאות יומיות', data: [], backgroundColor: '#ff9b9b' }] },
      options: { plugins: { legend: { display: false } }, scales: { y: { ticks: { color: '#dbeefc' } }, x: { ticks: { color: '#9aa3b2' } } } }
    });

    salesChart = new Chart(document.getElementById('salesChart').getContext('2d'), {
      type: 'bar',
      data: { labels: [], datasets: [{ label: 'מכירות יומיות', data: [], backgroundColor: '#9be0ff' }] },
      options: { plugins: { legend: { display: false } }, scales: { y: { ticks: { color: '#dbeefc' } }, x: { ticks: { color: '#9aa3b2' } } } }
    });

    pieExpenses = new Chart(document.getElementById('pieExpenses').getContext('2d'), {
      type: 'pie',
      data: { labels: [], datasets: [{ data: [], backgroundColor: ['#2f7eff', '#00ffcc', '#ffc857', '#ff9b9b', '#c77dff', '#7ef5a7', '#ffd1f0', '#9be0ff', '#ffb199', '#b0e2ff'] }] },
      options: { plugins: { legend: { position: 'right', labels: { color: '#fff' } } } }
    });
  }

  // --- UI Refresh ---
  function refreshUI() {
    renderTable(filtered || transactions);
    updateSummary(filtered || transactions);
    updateChartsFromData(filtered || transactions);
  }

  // --- Edit Modal Placeholder ---
  function openEditModal(tx) {
    const newPrice = prompt('ערוך מחיר:', tx.price);
    if (newPrice !== null) editTransaction(tx.id, { price: Number(newPrice) });
  }

  // --- Event Listeners ---
  btnBuy.onclick = () => { if (inputItem.value && inputPrice.value) addTransaction('buy', inputItem.value, inputPrice.value, inputDate.value || todayISO()); };
  btnSell.onclick = () => { if (inputItem.value && inputPrice.value) addTransaction('sell', inputItem.value, inputPrice.value, inputDate.value || todayISO()); };
  btnClear.onclick = () => { if (confirm('למחוק את כל הנתונים?')) { transactions = []; saveLocal(); refreshUI(); } };
  searchBox.oninput = applyFilters;
  btnFilter.onclick = applyFilters;
  btnResetFilter.onclick = resetFilters;

  // --- Init ---
  loadLocal();
  initCharts();
  refreshUI();
});

</script>




</body>
</html>
